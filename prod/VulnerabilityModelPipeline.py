import pandas as pd
from prod.VulnerabilityModelTrainer import VulnerabilityModelTrainer


class VulnerabilityModelPipeline:
    def __init__(self, data_path: str, model_path="rf_model.pkl", scaler_path="scaler.pkl"):
        """
        Initializes the training pipeline with file paths.
        :param data_path: Path to the CSV file containing labeled data.
        :param model_path: Path where the trained model will be saved.
        :param scaler_path: Path where the scaler will be saved.
        """
        self.data_path = data_path
        self.model_path = model_path
        self.scaler_path = scaler_path
        self.trainer = VulnerabilityModelTrainer()

    def run(self):
        """
        Executes the full pipeline: load data, preprocess, train, and save model.
        """
        print("[*] Loading data...")
        data = pd.read_csv(self.data_path)

        print("[*] Loading into trainer...")
        self.trainer.load_data(data)

        print("[*] Preprocessing data...")
        self.trainer.preprocess()

        print("[*] Training model...")
        accuracy = self.trainer.train()
        print(f"[+] Model trained with accuracy: {accuracy:.2f}")

        print("[*] Saving model and scaler...")
        self.trainer.save(self.model_path, self.scaler_path)
        print(f"[+] Model saved to: {self.model_path}")
        print(f"[+] Scaler saved to: {self.scaler_path}")

if __name__ == "__main__":
    pipeline = VulnerabilityModelPipeline(data_path="data/feature_vectors.csv")
    pipeline.run()
